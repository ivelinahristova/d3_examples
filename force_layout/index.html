<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
<h1></h1>
<div id="chart"></div>

<script>
    var data = [];

    var svg = d3.select("#chart").append("svg")
        .attr("width", 900)
        .attr("height", 500)
        .append("g");

    d3.csv('twin_cities.csv', function(dataset){
      data = dataset;
      var data_json = {
        "nodes": [],
        "links": []
      };
      for (var i = 0; i < data.length; i++) {
        console.log(data[i]);
        console.log(data[i]['Name']);

        for (var k in data[i]){
            if (data[i].hasOwnProperty(k)) {
                 console.log("Key is " + k + ", value is" + data[i][k]);
                 if(k !== 'Name') {
                   data_json["links"].push({"source": data[i]['Name'], "target": k, "value": data[i][k]});
                 }
            }
        }

        data_json["nodes"].push({"id": data[i]['Name']});
      }
      console.log(data_json);
      createForceLayoutChart();
    });

    var createForceLayoutChart = function() {
      console.log(data);
      var force = d3.layout.force()
      .nodes(data.nodes)
      .links(data.edges)
      .size([w, h])
      .linkDistance([50])
      .charge([-100])
      .start();

      var edges = svg.selectAll("line")
      .data(dataset.edges)
      .enter()
      .append("line")
      .style("stroke", "#ccc")
      .style("stroke-width", 1);

      var nodes = svg.selectAll("circle")
      .data(dataset.nodes)
      .enter()
      .append("circle")
      .attr("r", 10)
      .style("fill", function(d, i) {
        return colors(i);
      })
      .call(force.drag);
    }

</script>

</body>
</html>
